@echo off

IF "%1"=="" GOTO CHECK_ENV

SETLOCAL
SET MONGO_SERVER=%1

:RUN_SCRIPT
mongo %MONGO_SERVER%/{{.DbName}} {{.Filename}}_clean.js
IF "%1" == "clean" EXIT /B 0

{{range $change := .CollectionChanges}}
mongoimport --host %MONGO_SERVER% --db {{$.DbName}} --collection {{$change.CollectionName}} < {{$change.ImportScriptName}}
{{end}}

EXIT/B 0

:CHECK_ENV
IF NOT "%MONGO_SERVER%" == "" GOTO RUN_SCRIPT
ECHO "No server URL given as parameter"
EXIT /B 1